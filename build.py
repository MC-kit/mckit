from pathlib import Path

from extension_builder import MCKitBuilder
from extension_geometry import geometry_extension
from extension_nlopt import NLOptBuildExtension
from setuptools.dist import Distribution


class BinaryDistribution(Distribution):
    def is_pure(self):  # noqa
        return False


ext_modules = [NLOptBuildExtension(), geometry_extension]


def build(setup_kwargs):
    """
    Set specific distribution options.

    This function is called with setup.py generated by pip from pyproject.toml.
    """
    setup_kwargs.update(
        {
            "ext_modules": ext_modules,
            "cmdclass": {"build_ext": MCKitBuilder},
            "package_data": {"mckit": ["data/isotopes.dat", "nlopt.dll"]},
            "distclass": BinaryDistribution,
            "setup_requires": [
                "cmake==3.18.4",
                "numpy>=1.13",
                "mkl-devel",
            ],
            "long_description": Path("README.rst").read_text(encoding="utf8"),
        }
    )
